浏览器工作原理的学习Chrome毋庸置疑作为首选,不仅是因为作为开发者对chrome很熟悉，而且Chrome、微软的 Edge 以及国内的大部分主流浏览器，都是基于 Chromium 二次开发而来；而 Chrome 是 Google 的官方发行版，特性和 Chromium 基本一样，只存在一些产品层面差异；再加上 Chrome 是目前世界上使用率最高的浏览器，所以 Chrome 最具代表性。  
在开始之前，首先打开一个页面，再打开Chrome设置->更多工具->任务管理器，打开后就展示出当前Chrome使用的进程信息如下：  
* 浏览器  
* GPU进程  
* 实用进程：Network Service
* 实用进程：Storage Service(暂不介绍)
* 实用进程：Audio Service（暂不介绍）
* 标签页：xxx
这里没有放图片，感兴趣的读者自行打开Chrome任务管理器查看。和Window任务管理器一样，Chrome任务管理器也是用来展示运行中的Chrome使用的进程信息的。那为什么打开一个页面，会启动这么多进程尼？  
在回答这个问题之前，我需要再赘述一下线程和进程的关系，方便笔者加深记忆的同事读者也能更容易的理解
## 进程 VS 线程 

进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。**一个进程就是一个程序的运行实例。**
通俗的解释就是，启动一个程序，操作系统会为程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程

线程（英语：thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。
### 进程与线程的区别
1. 线程是程序执行的最小单位，而进程是**操作系统分配资源的最小单位**
2. 一个进程由一个或多个线程组成，线程是一个进程中代码的不同执行路线
3. 进程之间相互独立，但同一进程下的各线程共享程序的内存空间（包括代码段、数据集等）
4. 调度和切换：线程上下文切换比进程上下文切换快得多

比如我们要计算如下三个表达式的值，并显示结果
```js
a = 1+2
b = 8/4
c = 3*4
``` 
按照**单线程**的编码方式，我们可以把整个过程分解为四步：  
* 第一步  a = 1+2
* 第二步  b = 8/4
* 第三步  c = 3*4  
* 第四步 显示最后的计算结果  

如果采用**多线程**，会怎么样尼？我们只需要分两步：
* 第一步 三个线程同时执行三个表达式
* 第二步 显示最后的计算结果  
通过对比分析，单线程执行上面的案例，需要四步；而使用多线程只需要两步。因此，使用**多线程并行处理能大大提升性能。**

多线程可以并行处理任务，但是线程是不能单独存在的，如概念中所述，**线程被包含在进程之中，是进程中的实际运作单位，线程是由进程来启动和管理的**。
![线程案例图](https://github.com/doubone/javascript/blob/master/docs/images/%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E5%9B%BE.png "图片title展示")

1. 进程中的任意一线程执行异常出错，都会导致整个进程的崩溃。
因为同一进程下的多个线程是共享内存空间的，一个线程使用某些共享内存时，其他线程必须等他结束，才能使用这一块内存。如果这个线程出于某种原因崩溃**线程锁死**，其他线程也就没办法正常工作，也就是会卡死，导致进程崩溃。
2. 线程之间共享进程中的数据
线程之间可以对进程的**公共数据**进行读写操作。但是当某一个线程使用某些共享内存时，其他线程必须等他结束，才能使用这一块共享内存。
3. 当一个进程关闭之后，操作系统会回收进程所占用的内存。
当一个进程退出后，操作系统会回收改进程所申请使用的所有资源，即使其中任意线程因为操作不当导致内存泄露，当进程退出时，这些内存也会被操作系统回收。
4. 进程之间的内容相互隔离。
进程隔离是为保护操作系统中进程互不干扰，每一个进程只能访问自己占有的数据，也就避免了出现进程之间数据互相污染的情况。也正因如此，一个进程如果崩溃或者挂起，是不会影响到其他进程的。
## 单进程浏览器时代
>浏览器的所有功能模块都是运行在同一个进程里,包含了网络、插件、JavaScript运行环境、渲染引擎和页面等。早在2007年之前，市面上浏览器都是单进程的。
单进程浏览器架构图如下：
![单线程架构图](https://github.com/doubone/javascript/blob/master/docs/images/%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E5%9B%BE.png "单线程架构图")
如此多的功能模块都运行在一个进程中。就会导致浏览器**不稳定**、**不流畅**和**不安全**。
### 问题1:不稳定
早期浏览器需要借助于插件来实现Web视频、Web游戏等各种强大的功能，但是插件是最容易出问题的模块，并且还运行在浏览器进程中，所以一个插件的意外崩溃会引起整个浏览器的崩溃。
除了插件之外，**渲染引擎模块**也是不稳定的，通常一些复杂的JavaScript代码就有可能引起渲染殷勤马快的崩溃，和插件一样，渲染引擎的崩溃也会导致整个浏览器的崩溃。

### 问题2：不流畅
单线程架构图可以看到，***所有页面的渲染模块、JavaScript执行环境以及插件都是运行在同一个线程中的，这就是说同一时刻只能有一个模块可以执行.***
比如我们执行以下的代码：
```js
function sleep(){
    while(true){
        console.log('sleep')
    }
}
sleep()
```
如果让这段代码在一个单进程浏览器页面里运行，你感觉会发生什么？


## 多进程架构
单进程浏览器是指浏览器的所有功能模块都是运行在一个进程中
参考链接：
阮一峰老师[进程与线程的一个简单解释](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html?utm_source=feedly)